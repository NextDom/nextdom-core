{#

/* This file is part of Jeedom.
*
* Jeedom is free software: you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* Jeedom is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with Jeedom. If not, see <http://www.gnu.org/licenses/>.
*/

/* This file is part of NextDom.
*
* NextDom is free software: you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* NextDom is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with NextDom. If not, see <http://www.gnu.org/licenses/>.
*/

#}
<div id="interactThumbnailDisplay">
    <div class="action-bar">
        <div class="action-group">
            <a class="btn btn-danger" href="{{ HOMELINK }}"><i class="fas fa-chevron-left">&nbsp;&nbsp;</i>{{ 'Retour'}}</a>
        </div>
        <div class="action-group">
            <a class="btn btn-success pull-right" id="bt_addInteract2"><i class="fas fa-plus-circle">&nbsp;&nbsp;</i>{{ 'Ajouter' }}</a>
            <a class="btn btn-warning pull-right" id="bt_regenerateInteract2"><i class="fas fa-refresh">&nbsp;&nbsp;</i>{{ 'Regénerer' }}</a>
            <a class="btn btn-default pull-right" id="bt_testInteract2"><i class="fas fa-check">&nbsp;&nbsp;</i>{{ 'Tester' }}</a>
        </div>
    </div>
    <div class="box">
        <div class="box-header with-border">
            <h3 class="box-title"><i class="fas fa-comments">&nbsp;&nbsp;</i>{{ 'Interactions' }}</h3>
        </div>
        <div class="box-body">
            {% if interactTotal|length == 0 %}
                <div class="text-center">
                    <span>{{ 'Vous n\'avez encore aucune interaction. Cliquez sur ajouter pour commencer.' }}</span>
                </div>
            {% else %}
                <div class="input-group">
                    <div class="input-group-addon"><i class="fas fa-search"></i></div>
                    <input class="form-control" placeholder="{{ 'Rechercher...' }}" id="in_searchInteract"/>
                </div>
            {% endif %}
        </div>
    </div>
    {% if interactTotal|length > 0 %}
            {% if interactsList[-1]|length > 0 %}
                <div class="panel box">
                    <a class="box-header with-border accordion-toggle" data-toggle="collapse" data-parent="" href="#config_aucun">
                        <h3 class="box-title">
                            <span>{{ 'Aucun - ' }} {{ interactsList[-1]|length }} {{ 'interaction(s)' }}</span>
                        </h3>
                    </a>
                    <div id="config_aucun" class="panel-collapse collapse in">
                        <div class="box-body">
                            <div class="interactListContainer DisplayCard text-center">
                                {% for interact in interactsList[-1] %}
                                    <div class="interactDisplayCard cursor icon_gestion" data-interact_id="{{ interact.getId() }}" style="{% if not interact.getEnable() %}{{ interactDisabledOpacity }}{% endif %}">
                                        <img class="backgroundColor" src="/public/img/NextDom_Interaction.png" height="70"/>
                                        <p>{{ interact.getHumanName(true, true, true, true) }}</p>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
            {% set index = 0 %}
            {% for group in interactsListGroup %}
                {% if group['group'] != '' %}
                    <div class="panel box box-primary">
                        <a class="box-header with-border accordion-toggle" data-toggle="collapse" data-parent="" href="#config_{{ index }}">
                            <h3 class="box-title">
                                <span style="text-decoration:none;">{{ group['group'] }} - {{ interactsList[group['group']]|length }} {{ 'interaction(s)' }}</span>
                            </h3>
                        </a>
                        <div id="config_{{ index }}" class="panel-collapse collapse in">
                            <div class="box-body">
                                <div class="interactListContainer DisplayCard text-center">
                                    {% for interact in interactsList[group['group']] %}
                                        <div class="interactDisplayCard cursor icon_gestion" data-interact_id="{{ interact.getId() }}" style="{% if not interact.getEnable() %}{{ interactDisabledOpacity }}{% endif %}">
                                            <img class="backgroundColor" src="/public/img/NextDom_Interaction.png" height="70"/>
                                            <p>{{ interact.getHumanName(true, true, true, true) }}</p>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% set index = index + 1 %}
            {% endfor %}
    {% endif %}
</div>

<div class="interact" style="display: none;" id="div_conf">
    <div class="action-bar">
        <div class="action-group">
            <a class="btn btn-danger" id="bt_interactThumbnailDisplay"><i class="fas fa-chevron-left">&nbsp;&nbsp;</i>{{ 'Retour'}}</a>
        </div>
        <div class="action-group">
            <a class="btn btn-default displayInteracQuery pull-right"><i class="fas fa-eye">&nbsp;&nbsp;</i>{{ 'Phrase(s)' }} <span class="label label-success interactAttr" data-l1key="nbInteractQuery"></span></a>
        </div>
        <div class="action-group">
            <a class="btn btn-success pull-right" id="bt_saveInteract"><i class="fas fa-save">&nbsp;&nbsp;</i>{{ 'Enregistrer' }}</a>
            <a class="btn btn-default pull-right" id="bt_duplicate"><i class="far fa-files-o">&nbsp;&nbsp;</i>{{ 'Dupliquer' }}</a>
            <a class="btn btn-danger pull-right" id="bt_removeInteract"><i class="fas fa-minus-circle">&nbsp;&nbsp;</i>{{ 'Supprimer' }}</a>
        </div>
    </div>
    <div class="nav-tabs-custom">
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#generaltab" aria-controls="home" role="tab" data-toggle="tab"><i class="fas fa-tachometer-alt">&nbsp;&nbsp;</i>{{ 'Général' }}</a></li>
            <li role="presentation"><a href="#filtertab" aria-controls="profile" role="tab" data-toggle="tab"><i class="fas fa-filter">&nbsp;&nbsp;</i>{{ 'Filtres' }}</a></li>
            <li role="presentation"><a href="#actiontab" aria-controls="profile" role="tab" data-toggle="tab"><i class="fas fa-cogs">&nbsp;&nbsp;</i>{{ 'Actions' }}</a></li>
        </ul>

        <div class="tab-content" style="height:calc(100% - 50px);overflow:auto;overflow-x: hidden;">
            <div role="tabpanel" class="tab-pane active" id="generaltab">
                <form class="form-horizontal">
                    <br/>
                    <fieldset>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Nom' }}</label>
                            <div class="col-sm-9 col-xs-12">
                                <input class="form-control interactAttr" type="text" data-l1key="name" placeholder=""/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Groupe' }}</label>
                            <div class="col-sm-9 col-xs-12">
                                <input class="form-control interactAttr" type="text" data-l1key="group" placeholder=""/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Actif' }}</label>
                            <div class="col-sm-9 col-xs-12">
                                <input class="interactAttr" type="checkbox" data-l1key="enable" placeholder=""/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Demande' }}</label>
                            <div class="col-sm-9 col-xs-12">
                                <input class="form-control interactAttr" type="text" data-l1key="id" style="display : none;"/>
                                <input class="form-control interactAttr" type="text" data-l1key="query" placeholder=""/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Regexp de correspondance obligatoire' }}</label>
                            <div class="col-sm-9 col-xs-12">
                                <input class="form-control interactAttr" type="text" data-l1key="options" data-l2key="mustcontain"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Synonyme' }}</label>
                            <div class="col-sm-9 col-xs-12">
                                <input class="form-control interactAttr" type="text" data-l1key="options" data-l2key="synonymes" placeholder="" title="{{ 'Remplace les mots par leurs synonymes lors de la génération des commandes' }}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Réponse' }}</label>
                            <div class="col-sm-8 col-xs-12">
                                <textarea class="form-control interactAttr ta_autosize" type="text" data-l1key="reply" placeholder=""></textarea>
                            </div>
                            <div class="col-sm-1">
                                <a class="btn btn-sm btn-default cursor listEquipementInfoReply input-sm"><i class="fas fa-list-alt "></i></a>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Attendre avant de répondre' }}</label>
                            <div class="col-sm-4 col-xs-12">
                                <div class="input-group">
                                    <input type="number" class="form-control interactAttr" type="text" data-l1key="options" data-l2key="waitBeforeReply" placeholder="" title="{{ 'Permet d\'attendre le temps que l\'état d\'une lampe soit mise à jour par exemple' }}"/>
                                    <span class="input-group-addon">{{'secondes'}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Conversion binaire' }}</label>
                            <div class="col-sm-9 col-xs-12">
                                <input class="form-control interactAttr" type="text" data-l1key="options" data-l2key="convertBinary" placeholder="" title="{{ 'Convertir les commandes binaires' }}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Utilisateurs autorisés' }}</label>
                            <div class="col-sm-9 col-xs-12">
                                <input class="form-control interactAttr" type="text" data-l1key="person" placeholder="" title="{{ 'Liste des utilisateurs (identifiants) séparés par un |' }}"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 col-xs-12 control-label">{{ 'Regexp d\'exclusion' }}</label>
                            <div class="col-sm-9 col-xs-12">
                                <input class="form-control interactAttr" type="text" data-l1key="options" data-l2key="exclude_regexp" placeholder=""/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-2 col-xs-12 control-label">{{ 'Autorisation' }}</label>
                            <div class="col-lg-10 col-xs-12">
                                <input type="checkbox" class="interactAttr" data-l1key="options" data-l2key="allowSyntaxCheck">
                                <label for="ldap" class="control-label label-check">{{ 'Autoriser NextDom à supprimer les demandes syntaxiquement incorrectes' }}</label>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div role="tabpanel" class="tab-pane" id="filtertab">
                <br/>
                <form class="form-horizontal" id="div_filtre">
                    <fieldset>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{ 'Limiter aux commandes de type' }}</label>
                            <div class="col-sm-9">
                                {% for id, type in interactCmdType %}
                                    <label style="margin-right:25px;">
                                        <input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="type" data-l3key="{{ id }}" checked="true"/>
                                        {{ type['name'] }}
                                     </label>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{ 'Limiter aux commandes ayant pour sous-type' }}</label>
                            <div class="col-sm-9">
                                {% for type in interactCmdType %}
                                    {% for id, subtype in type['subtype'] %}
                                        <label style="margin-right:25px;">
                                            <input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="subtype" data-l3key="{{ id }}" checked="true"/>
                                            {{ subtype['name'] }}
                                        </label>
                                    {% endfor %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{ 'Limiter aux commandes ayant pour unité' }}</label>
                            <div class="col-sm-9">
                                <label style="margin-right:25px;">
                                    <input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="unite" data-l3key="none" checked="true"/>
                                    {{ 'Sans unité' }}
                                </label>
                                {% for unite in interactAllUnite %}
                                    {% if unite['unite']|trim != '' %}
                                        <label style="margin-right:25px;">
                                            <input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="unite" data-l3key="{{ unite['unite'] }}" checked="true"/>
                                            {{ unite['unite'] }}
                                        </label>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{ 'Limiter aux commandes appartenant aux objets' }}</label>
                            <div class="col-sm-9">
                                {% for jeeObject in interactJeeObjects %}
                                    <label style="margin-right:25px;">
                                        <input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="object" data-l3key="{{ jeeObject.getId() }}" checked="true"/>
                                        {{ jeeObject.getName() }}
                                    </label>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{ 'Limiter aux plugins' }}</label>
                            <div class="col-sm-9">
                                {% for eqLogicType in interactEqLogicTypes %}
                                      <label style="margin-right:25px;">
                                          <input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="plugin" data-l3key="{{ eqLogicType['type'] }}" checked="true"/>
                                          {{ eqLogicType['type'] }}
                                      </label>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{ 'Limiter aux catégories' }}</label>
                            <div class="col-sm-9">
                                <label style="margin-right:25px;"><input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="category" data-l3key="noCategory" checked="true"/>{{ 'Sans catégorie' }}</label>
                                {% for id, category in interactEqLogicCategories %}
                                    <label style="margin-right:25px;">
                                        <input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="category" data-l3key="{{ id }}" checked="true"/>
                                        {{ category['name'] }}
                                    </label>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{ 'Limiter aux visibles' }}</label>
                            <div class="col-sm-9">
                                <label style="margin-right:25px;"><input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="visible" data-l3key="object"/>{{ 'Objets' }}</label>
                                <label style="margin-right:25px;"><input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="visible" data-l3key="eqlogic"/>{{ 'Equipements' }}</label>
                                <label style="margin-right:25px;"><input class="interactAttr" type="checkbox" data-l1key="filtres" data-l2key="visible" data-l3key="cmd"/>{{ 'Commandes' }}</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{ 'Limiter à l\'équipement' }}</label>
                            <div class="col-sm-6">
                                <select class='interactAttr form-control' data-l1key='filtres' data-l2key='eqLogic_id'>
                                    <option value="all">{{ 'Tous' }}</option>
                                    {% for eqLogic in interactEqLogics %}
                                        <option value="{{ eqLogic.getId() }}">{{ eqLogic.getHumanName() }}</option>';
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div role="tabpanel" class="tab-pane" id="actiontab">
                <a class="btn btn-success btn-sm pull-right" id="bt_addAction" style="margin-top:5px;"><i class="fas fa-plus-circle"></i> {{ 'Ajouter' }}</a>
                <br/><br/>
                <form class="form-horizontal">
                    <fieldset>
                        <div id="div_action"></div>
                    </fieldset>
                </form>
            </div>
        </div>
    </section>
</div>
